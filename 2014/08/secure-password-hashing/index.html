<!DOCTYPE html>
<html lang="en">
<head>
    <title>
                                    Secure Password Hashing with PHP | The Dev Files
                        </title>
    <meta charset="utf-8">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <meta name="description" content="The password_hash function added in PHP 5.5 makes secure password hashing easy.">
                            <meta name="author" content="Jonathan Bernardi">
            
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.thedevfiles.com/2014/08/secure-password-hashing/">
                    <link rel="author" href="/contact/">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <link href="/assets/css/style.css" rel="stylesheet" type="text/css"/>

    <link rel="apple-touch-startup-image" href="/assets/images/favicon/2048x2048.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="shortcut icon" sizes="76x76" href="/assets/images/favicon/76x76.png">
<link rel="shortcut icon" sizes="120x120" href="/assets/images/favicon/120x120.png">
<link rel="shortcut icon" sizes="128x128" href="/assets/images/favicon/128x128.png">
<link rel="shortcut icon" sizes="152x152" href="/assets/images/favicon/152x152.png">
<link rel="shortcut icon" sizes="196x196" href="/assets/images/favicon/196x196.png">
<link rel="shortcut icon" sizes="512x512" href="/assets/images/favicon/512x512.png">
<link rel="shortcut icon" sizes="1024x1024" href="/assets/images/favicon/1024x1024.png">
<link rel="shortcut icon" sizes="2048x2048" href="/assets/images/favicon/2048x2048.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicon/76x76.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicon/120x120.png">
<link rel="apple-touch-icon" sizes="128x128" href="/assets/images/favicon/128x128.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicon/152x152.png">
<link rel="apple-touch-icon" sizes="196x196" href="/assets/images/favicon/196x196.png">
<link rel="apple-touch-icon" sizes="512x512" href="/assets/images/favicon/512x512.png">
<link rel="apple-touch-icon" sizes="1024x1024" href="/assets/images/favicon/1024x1024.png">
<link rel="apple-touch-icon" sizes="2048x2048" href="/assets/images/favicon/2048x2048.png">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/solarized_dark.min.css">
    <link rel="alternate" type="application/atom+xml" href="/atom.xml"
          title="The Dev Files activity feed"/>
                </head>
<body itemscope="http://schema.org/Blog">
<header class="siteheader">
    <div class="content-wrapper">
        <h2 class="siteheader__title"><a href="/">The Dev Files</a></h2>
        <small class="siteheader__subtitle">Development Blog of Jonathan Bernardi</small>
    </div>
</header>
<div class="menu menu--main">
    <div class="content-wrapper">
        <nav class="menu__nav" role="navigation">
    <ul class="menu__links">
        <li class="menu__item">
            <a class="menu__link" href="/">Blog</a>
        </li>
        <li class="menu__item">
            <a class="menu__link" href="/archive/">Archive</a>
        </li>
        <li class="menu__item">
            <a class="menu__link" href="/contact/">Contact</a>
        </li>
        <li class="menu__item menu__item--rss">
            <a class="menu__link" href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">
                <i class="fa fa-rss"></i>
                <span class="sr-only">RSS</span>
            </a>
        </li>
    </ul>
</nav>
        <div class="menu__right">
            <form class="search" action="https://www.google.com/search" method="get" role="search">
    <input type="hidden" name="q" value="site:www.thedevfiles.com">
    <input class="search__input" type="search" name="q" results="0" placeholder="Search">
</form>
        </div>
    </div>
</div>

<div class="middle-section">
    <div class="content-wrapper">
        <section class="main">

                <article class="post h-entry" itemid="https://www.thedevfiles.com/2014/08/secure-password-hashing/" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

        <header class="post__header">
            <h1 class="post__title p-name" itemprop="headline">Secure Password Hashing with PHP</h1>

            <h2 class="post__date">Aug 22nd, 2014</h2>
                            <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
                    <meta class="u-photo" itemprop="contentUrl" content="https://www.thedevfiles.com">
                </div>
                    </header>
        <div class="post__body e-content" itemprop="articleBody">
            <p>There is a lot of misinformation and uncertainty on the topic of password storage.</p>

<p>There are massive amounts of tutorials and articles recommending all manor of methods of storing passwords.
A large number of these are old and using methods that just are up to snuff for todays security standards.</p>

<!--more-->

<h2 id="common-password-storing-mistakes">Common password storing mistakes</h2>

<p>Here are some of the most common mistakes make with regards to password hashing.</p>

<p>I've been guilty of all of these in the past.</p>

<h3 id="md5-and-sha1-hashing">MD5 and SHA1 hashing</h3>

<p>The <a href="http://us1.php.net/manual/en/function.md5.php">md5</a> and <a href="http://us1.php.net/manual/en/function.sha1.php">sha1</a> are not suitable for password hashing.</p>

<p>This is true for any of the related hashing algorithms from the <a href="http://us1.php.net/manual/en/function.hash.php">hash</a> function like sha256, sha512, and so on.
While the larger hashes are slightly better than the shorter ones they all suffer from the same problem.</p>

<p>Over time computers are getting faster and faster and can calculate a hash in a shorter amount of time.
A high end machine with a cluster of GPUs can calculate billions of md5 hashes a second.
You can rent such a machine from <a href="http://aws.amazon.com/ec2/pricing/">Amazon</a> for less than $1 an hour.</p>

<p>Over time each of these hashing functions will become faster and faster to break.</p>

<p>The other weakness of these algorithms is that unless the passwords are also salted they are susceptible to rainbow table attacks.</p>

<p>Every time a password is hashed it will result in the same hash.
This means if you have a list of hashes and their corresponding passwords you can just find the hash in the list to break the password.</p>

<h3 id="trying-to-create-your-own-hashing-algorithm">Trying to create your own hashing algorithm</h3>

<p>People have tried to get around the fast hashing algorithms by running them multiple times or trying to mix and match them to create their own hashing algorithm.</p>

<p>The problem is that the hashes can be calculated so fast that it would take thousands of hashes to make a difference.
Even then at time moves on computers will get even faster and the number of necessary hashes will just keep increasing.</p>

<h3 id="using-the-same-salt-for-all-passwords">Using the same salt for all passwords</h3>

<p>Using the same salt for all passwords is much better then not using a salt at all.</p>

<p>Every password should have its own salt.</p>

<h2 id="the-solution">The Solution</h2>

<p>So how should passwords be hashed?</p>

<ol>
<li>Each password needs to be salted with a different cryptographic salt.</li>
<li>The hashing algorithm must not be fast regardless of the power of the machine used to generate them.</li>
</ol>

<p>The current recommended methods for securely hashing passwords are <a href="http://en.wikipedia.org/wiki/Bcrypt">Bcrypt</a> or <a href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>.</p>

<p>The Bcrypt algorithm can be used with the <a href="http://us1.php.net/manual/en/function.crypt.php">crypt</a> function but this isn't very easy to use.
You still need to generate a cryptographic salt and that isn't very easy either.</p>

<p>Thankfully there is now a better way.</p>

<p>PHP 5.5 added the <a href="http://php.net/manual/en/function.password-hash.php">password_hash</a> function which hides the ugliness of using the crypt function and makes secure password hashing truly easy.</p>

<p>Not using PHP 5.5+?  The <a href="https://github.com/ircmaxell/password_compat">ircmaxell/password_compat</a> library will add the same functionality to PHP 5.3.7+.</p>

<p>Even better? The password_hash function is future proof.  While Bcrypt is the best algorithm available to PHP for hashing passwords this may not always be the case.
As better algorithms are released the password_hash function will automatically use the best algorithm available.</p>

<p>Your application will begin to use the newer more secure algorithm without you even touching the code.</p>

<h2 id="using-password_hash-for-password-hashing">Using password_hash for password hashing</h2>

<p>For this example I'm assuming you have a database table called users with a username and a password column.</p>

<p>I'm also using PDO for the database interactions.
If you need help using PDO take a look at the article I wrote about <a href="/2014/08/moving-from-mysql-query-to-pdo/">Migrating from mysql_query to PDO</a>.
Make sure to use prepared statements to prevent SQL injection.</p>

<pre><code class="php">&lt;?php

class UserModel
{

    /**
     * @var PDO
     */
    protected $dbh;

    /**
     * @param PDO $dbh
     */
    public function __construct(PDO $dbh)
    {
        $this-&gt;dbh = $dbh;
    }

    /**
     * Checks account credentials
     *
     * @param string $username
     * @param string $password
     *
     * @return array|false Array of user data if credentials are correct or boolean false if credentials are not correct
     */
    public function checkCredentials($username, $password)
    {
        $user = $this-&gt;getUserByUsername($username);
        if (!$user) {
            // No user found with provided username
            return false;
        }
        if (!password_verify($password, $user['password'])) {
            // Password does not match
            return false;
        }
        if (password_needs_rehash($user['password'], PASSWORD_DEFAULT)) {
            // This password was hashed using an older algorithm, update with new hash.
            $this-&gt;updatePassword($user['id'], $password);
        }
        // The password is no longer needed from the user data
        unset($user['password']);
        return $user;
    }

    /**
     * Returns a user by username
     *
     * @param string $username
     *
     * @return array|false Array of user data if found or boolean false if not found
     */
    public function getUserByUsername($username)
    {
        $sth = $this-&gt;dbh-&gt;prepare("SELECT * FROM users WHERE username LIKE :username");
        $sth-&gt;bindValue(":username", $username);
        $sth-&gt;execute();
        return $sth-&gt;fetch(PDO::FETCH_ASSOC);
    }

    /**
     * Updates a user's password
     *
     * @param int $id
     * @param string $password
     *
     * @return int Number of affected rows
     */
    public function updatePassword($id, $password)
    {
        $hash = password_hash($password, PASSWORD_DEFAULT);
        $sth = $this-&gt;dbh-&gt;prepare("UPDATE users SET password = :password WHERE id = :id");
        $sth-&gt;bindValue(":password", $hash);
        $sth-&gt;bindValue(":id", $id, PDO::PARAM_INT);
        return $sth-&gt;execute();
    }
}

</code></pre>

<h3 id="how-it-works">How it works</h3>

<ol>
<li>You pass the username and password the user provided in the login form to the checkCredentials method.</li>
<li>This method searches the database for a user with a matching username.</li>
<li>If no user is found the provided username was incorrect.</li>
<li>Next the <a href="http://php.net/manual/en/function.password-verify.php">password_verify</a> is called to check if the password was used to generate the hash that was stored in the database for the user with the matching username.</li>
<li>If it returns false then the provided password was incorrect.</li>
<li>Now that we have confirmed the provided login credentials are correct we pass the hashed password from the database to <a href="http://php.net/manual/en/function.password-needs-rehash.php">password_needs_rehash</a>.  This checks if the password needs to be upgraded to a newer, stronger algorithm.</li>
<li>If it returns true update the user's password by passing the provided password to the <a href="http://php.net/manual/en/function.password-hash.php">password_hash</a> function.</li>
<li>Return the user account so you can log the user in.</li>
</ol>

        </div>
        <footer class="post__footer">
            <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="The Dev Files">
            </div>
            <meta itemprop="dateModified" content="2014-08-22T00:00:00-07:00">
            <meta itemprop="mainEntityOfPage" content="https://www.thedevfiles.com/2014/08/secure-password-hashing/">


            <ul class="past__meta">
                <li class="post__byline">Posted by <span class="post__author p-author h-card" itemprop="author">Jonathan Bernardi</span></li>
                <li>
                    <time class="post__date--footer dt-published" itemprop="datePublished" content="2014-08-22T00:00:00-07:00"
                          datetime="2014-08-22T00:00:00-07:00">Aug 22nd, 2014</time>
                </li>
                                    <li>
                        <span class="post__tags p-category">
                                                    <a class="post__tag"
                               href="/tag/php/">php</a>,                                                     <a class="post__tag"
                               href="/tag/security/">security</a>                                                </span>
                    </li>
                            </ul>
            <meta class="u-url" itemprop="url" content="https://www.thedevfiles.com/2014/08/secure-password-hashing/">
                            <meta itemprop="keywords" content="php, security">
                                        <meta class="p-summary" itemprop="description" content="The password_hash function added in PHP 5.5 makes secure password hashing easy.">
                    </footer>

                    <div class="sharing">
            <a href="//twitter.com/share" class="twitter-share-button" data-url="https://www.thedevfiles.com/2014/08/secure-password-hashing/" data-via="thejonbernardi" data-counturl="https://www.thedevfiles.com/2014/08/secure-password-hashing/" >Tweet</a>
                <div class="g-plusone" data-size="medium"></div>
        </div>
        
                    <nav class="pagination pagination--simple">
                <ul>
                                            <li class="pagination--simple__previous">
                            <a href="/2014/08/simplifying-database-interactions-with-doctrine-dbal/">&laquo; Simplifying database interactions with Doctrine DBAL</a>
                        </li>
                                                                <li class="pagination--simple__next">
                            <a href="/2014/09/building-a-simple-contact-form-in-php-part-1/">Building a simple contact form in PHP - Part 1 &raquo;</a>
                        </li>
                                    </ul>
            </nav>
        
                    <section class="post__comments">
    <h2>Comments</h2>
    <div id="disqus_thread" aria-live="polite">
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>
        
    </article>



        </section>
        <section class="sidebar">
    <aside class="widget widget--about h-card">
    <h4 class="widget__title p-name">Jonathan Bernardi</h4>

    <div class="widget__body">
        <div class="widget--about__gravatar">
            <img class="u-photo" src="//www.gravatar.com/avatar/7a5252ed2b4a12954535820e06fd0faa" alt="Jonathan Bernardi">
        </div>
        <div class="widget--about__social">
                            <a target="_blank" href="https://twitter.com/thejonbernardi" title="Twitter"><i class="fa fa-twitter"></i></a>
                                                    <a target="_blank" href="https://plus.google.com/116642652326925126482" title="Google+"><i class="fa fa-google-plus"></i></a>
                                                    <a target="_blank" href="http://www.linkedin.com/pub/jonathan-bernardi/57/318/99a" title="LinkedIn"><i class="fa fa-linkedin"></i></a>
                                        <a target="_blank" href="https://github.com/spekkionu" title="Github"><i class="fa fa-github"></i></a>
                                </div>
    </div>
</aside>
    <aside class="widget widget--monthly">
    <h4 class="widget__title">Monthly Arhives</h4>

    <div class="widget__body">
        <ul class="widget--monthly__list">
                        <li>
                <a class="widget--monthly__year " href="/2014/">2014 (9)</a>

                                    <ul class="widget--monthly__months">
                                            <li>
                            <a class="widget--monthly__month " href="/2014/09/">
                                Sep
                                (6)
                            </a>
                        </li>
                                            <li>
                            <a class="widget--monthly__month " href="/2014/08/">
                                Aug
                                (3)
                            </a>
                        </li>
                                        </ul>
                            </li>
                    </ul>
    </div>
</aside>



    <aside class="widget widget--tags">
    <h4 class="widget__title">Tags</h4>

    <div class="widget__body">
                    <span class="tag size2"><a href="/tag/doctrine/">doctrine</a></span>
            &nbsp;
                    <span class="tag size2"><a href="/tag/pdo/">pdo</a></span>
            &nbsp;
                    <span class="tag size3"><a href="/tag/database/">database</a></span>
            &nbsp;
                    <span class="tag size6"><a href="/tag/mail/">mail</a></span>
            &nbsp;
                    <span class="tag size2"><a href="/tag/security/">security</a></span>
            &nbsp;
                    <span class="tag size2"><a href="/tag/mysql/">mysql</a></span>
            &nbsp;
                    <span class="tag size9"><a href="/tag/php/">php</a></span>
            &nbsp;
            </div>
</aside>



</section>
    </div>
</div>
<footer class="sitefooter">
    <div class="content-wrapper">
        Copyright &copy; 2016 - Jonathan Bernardi
    </div>
</footer>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


            <script type="text/javascript">
    var disqus_shortname = 'thedevfiles';
    var disqus_developer = 1;
    var disqus_identifier = 'https://www.thedevfiles.com/2014/08/secure-password-hashing/';
    var disqus_title = 'Secure Password Hashing with PHP';
    var disqus_url = 'https://www.thedevfiles.com/2014/08/secure-password-hashing/';
    var disqus_script = 'embed.js';
    function disqus_config() {
        this.callbacks.onNewComment = [function (comment) {
            ga('send', 'event', 'comment', 'post', 'Post a Comment');
        }];
    }
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
    
                        <script type="text/javascript">
        (function() {
            var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
            script.src = 'https://apis.google.com/js/plusone.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
        })();
    </script>
            <script type="text/javascript">
        (function(){
            var twitterWidgets = document.createElement('script');
            twitterWidgets.type = 'text/javascript';
            twitterWidgets.async = true;
            twitterWidgets.src = '//platform.twitter.com/widgets.js';
            document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
        })();
    </script>
    <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KBZCND"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KBZCND');</script>
<!-- End Google Tag Manager -->
</body>
</html>
